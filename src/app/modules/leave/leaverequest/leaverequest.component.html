
<app-shared-nav class="sharednav"[buttons]="buttons"></app-shared-nav>

<div class="col-md-9 main-body">
 
    <div class="card card-body">
      <div class="card-header cardhead">
        <h4 class="card-title">Leave Request</h4>
        <p class="card-category">Complete your Leave Request</p>
      </div>
      
      <form>
        <div class="card-body">
          <div class="row">
            <div class="col-md-4 form-group">
              <mat-select class="select" placeholder="Select Employee" name="selectedEmployee" required [(ngModel)]="selectedEmployee">
                <mat-option *ngFor="let employee of employees" [value]="employee.empId">
                  {{ employee.firstName + ' ' + employee.middleName + ' ' + employee.lastName }}
                </mat-option>
              </mat-select>
            </div>
            <div class="col-md-4 form-group">
              <mat-select class="select"  placeholder="Select Leave Type" name="selectedLeaveType" required [(ngModel)]="selectedLeaveType" (ngModelChange)="availableLeaveBalance()">
                <mat-option *ngFor="let leaveType of leaveTypes" [value]="leaveType.leaveTypeId">
                  {{ leaveType.leaveTypeName }}
                </mat-option>
              </mat-select>
            </div>
            <div class="col-md-4">
              <label *ngIf="selectedLeaveBalance > 0">Available Balance</label>
              <input class="form-control" *ngIf="selectedLeaveBalance > 0" name="selectedLeaveBalance" required [(ngModel)]="selectedLeaveBalance" [disabled]="true">
              <div *ngIf="selectedLeaveBalance <= 0 && leaveName">
                <p class="insufficient-balance">Insufficient Balance</p>
              </div>
              <label *ngIf="leaveName === 'Annual'">Previous Year Balance</label>
              <input class="form-control" *ngIf="leaveName === 'Annual'" name="selectedPreviousYear" required [(ngModel)]="selectedPreviousYear" [disabled]="true">
              <label *ngIf="leaveName === 'Annual'">Previous 2 Balance</label>
              <input class="form-control" *ngIf="leaveName === 'Annual'" name="selectedTwoPerviousYear" required [(ngModel)]="selectedTwoPerviousYear" [disabled]="true">
            </div>
          </div>
          
          <div class="row">
            <div class="col-md-4 form-group mt-3">
              <label for="name">Working Days</label>
              <input class="form-control" placeholder="Working Days" type="text" name="workingDays" [(ngModel)]="leaveRequest.workingDays">
            
            </div>
            <div class="col-md-4 form-group mt-3">
              <label for="name">Reason</label>
              <input class="form-control" placeholder="Reason" type="text" name="reason" [(ngModel)]="leaveRequest.reason">
              
            </div>
            <div class="col-md-4 mt-3">
              <label for="name">Supporting File</label>
              <input placeholder=" " name="file" class="form-control" type="file" id="file"  (change)="onFileSelected($event)" #fileInput>
             
            </div>
          </div>
          
          <div class="row mt-3">
            <div class="col-md-4">
              <mat-form-field style="height: 65px; width: 160px;" class="example-full-width">
                <input matInput [matDatepicker]="fromPicker" placeholder="Start Date" name="from" [(ngModel)]="leaveRequest.startDate">
                <mat-datepicker-toggle matSuffix [for]="fromPicker"></mat-datepicker-toggle>
                <mat-datepicker #fromPicker></mat-datepicker>
              </mat-form-field>
            </div>
            <div class="col-md-4">
              <mat-form-field style="height: 65px; width: 160px; font-size: 15px;" class="example-full-width">
                <input matInput [matDatepicker]="toPicker" placeholder="End Date" name="to" [(ngModel)]="leaveRequest.endDate">
                <mat-datepicker-toggle matSuffix [for]="toPicker"></mat-datepicker-toggle>
                <mat-datepicker #toPicker></mat-datepicker>
              </mat-form-field>
            </div>
          </div>
          
          <div class="mt-3">
            <button type="button" class="btn btnsave btn-sm" *ngIf="!leaveRequest.leaveRequestId" (click)="addleaveRequest()">Add</button>
            <div *ngIf="leaveRequestSaved" class="alert btndanger btn-sm pull-right">Added successfully!</div>
            <button type="button" class="btn btnsave btn-sm" *ngIf="leaveRequest.leaveRequestId" (click)="updateleaveRequest()">Update</button>
            <div *ngIf="leaveRequestUpdated" class="alert btndanger btn-sm pull-right">Updated successfully!</div>
          </div>
        </div>
      </form>

              <h6>Leave Request History</h6>
              <table *ngIf="leaveRequest" class="table table-striped table-bordered compact-table">
                <thead>
                  <tr>
                    <th>Employee</th>
                    
                    <th>Leave Type</th>
                    <th>Start Date</th>
                    <th>End Date</th>
                    <th>Status</th>
                    <th>Approved By</th>
                    <th>Approved Date</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody>
                  <!-- Use *ngFor to loop through the leaveRequests array and display each leaveRequest record -->
                  <tr *ngFor="let leaveRequest of leaveRequests">
                    <td>{{ getEmployeeName(leaveRequest.empId) }}</td>
                    
                    <td>{{ getLeaveTypeName(leaveRequest.leaveTypeId) }}</td>
                   
                    <td>{{ leaveRequest.startDate | date:'yyyy-MM-dd' }}</td>
                    <td>{{ leaveRequest.endDate | date:'yyyy-MM-dd' }}</td>
                    <td>{{ leaveRequest.leaveStatus }}</td>
                    <td>{{ leaveRequest.approvedBy }}</td>
                    <td>{{ leaveRequest.approvedDate | date:'yyyy-MM-dd' }}</td>
                  
                    <td><button (click)="fetchAndDisplayPDF(leaveRequest)" 
                      style="background-color: #007bff; color: #fff; border: none; padding: 5px 10px; cursor: pointer; border-radius: 5px;"  download="filename.pdf" >File</button></td>
                    <!-- Add a button to trigger fetching and displaying the PDF -->
                   
                    <td>
                      <button class="btn btn-sm btnedit" (click)="editleaveRequest(leaveRequest)">
                        <mat-icon>edit</mat-icon>Edit
                      </button>
                      <button class="btn btn-sm btndanger" *ngIf="leaveRequest.leaveStatus === 'pending'" (click)="deleteleaveRequest(leaveRequest)">
                        <mat-icon>delete</mat-icon>Delete
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
              
            
               
            </div>
          </div>
                
       
 